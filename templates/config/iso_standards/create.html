{% extends "base.html" %}

{% block title %}Nouvelle Norme ISO - Configuration - EcoQuality{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-certificate me-2"></i>Nouvelle Norme ISO</h4>
                </div>
                <div class="card-body">
                    <form method="POST" id="isoForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="standard_code" class="form-label">Code ISO *</label>
                                <input type="text" class="form-control" id="standard_code" name="standard_code" 
                                       required placeholder="ex: ISO 13006">
                                <div class="form-text">Code de la norme ISO (ex: ISO 13006, ISO 10545-3)</div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="test_type" class="form-label">Type de Test *</label>
                                <select class="form-select" id="test_type" name="test_type" required onchange="updateCategories()">
                                    <option value="">Sélectionner un type</option>
                                    <option value="dimensional">Test Dimensionnel</option>
                                    <option value="water_absorption">Absorption d'Eau</option>
                                    <option value="breaking_strength">Résistance à la Rupture</option>
                                    <option value="abrasion">Résistance à l'Abrasion</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="title" class="form-label">Titre de la Norme *</label>
                            <input type="text" class="form-control" id="title" name="title" required
                                   placeholder="ex: Classification des carreaux céramiques">
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="category" class="form-label">Catégorie *</label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="">Sélectionner une catégorie</option>
                                </select>
                                <div class="form-text">La catégorie dépend du type de test sélectionné</div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="unit" class="form-label">Unité</label>
                                <input type="text" class="form-control" id="unit" name="unit" 
                                       placeholder="ex: mm, %, N">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="min_threshold" class="form-label">Seuil Minimum</label>
                                <input type="number" class="form-control" id="min_threshold" name="min_threshold" 
                                       step="0.01" placeholder="Valeur minimale acceptée">
                                <div class="form-text">Laissez vide si pas de minimum</div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="max_threshold" class="form-label">Seuil Maximum</label>
                                <input type="number" class="form-control" id="max_threshold" name="max_threshold" 
                                       step="0.01" placeholder="Valeur maximale acceptée">
                                <div class="form-text">Laissez vide si pas de maximum</div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3"
                                      placeholder="Description détaillée de la norme et de son application"></textarea>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('iso_standards_index') }}" class="btn btn-secondary">
                                <i class="fas fa-times me-1"></i>Annuler
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Créer la Norme
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function updateCategories() {
    const testType = document.getElementById('test_type').value;
    const categorySelect = document.getElementById('category');
    const unitInput = document.getElementById('unit');
    
    // Clear existing options
    categorySelect.innerHTML = '<option value="">Sélectionner une catégorie</option>';
    
    const categories = {
        'dimensional': [
            {value: 'length', text: 'Longueur', unit: 'mm'},
            {value: 'width', text: 'Largeur', unit: 'mm'},
            {value: 'thickness', text: 'Épaisseur', unit: 'mm'},
            {value: 'warping', text: 'Gauchissement', unit: 'mm'}
        ],
        'water_absorption': [
            {value: 'water_absorption', text: 'Absorption d\'eau', unit: '%'}
        ],
        'breaking_strength': [
            {value: 'breaking_strength', text: 'Résistance à la rupture', unit: 'N'}
        ],
        'abrasion': [
            {value: 'abrasion_resistance', text: 'Résistance à l\'abrasion', unit: 'PEI'}
        ]
    };
    
    if (testType && categories[testType]) {
        categories[testType].forEach(category => {
            const option = document.createElement('option');
            option.value = category.value;
            option.textContent = category.text;
            categorySelect.appendChild(option);
        });
        
        // Set suggested unit
        if (categories[testType].length > 0) {
            unitInput.value = categories[testType][0].unit;
        }
    }
}

// Update categories when category changes to set unit
document.getElementById('category').addEventListener('change', function() {
    const testType = document.getElementById('test_type').value;
    const category = this.value;
    const unitInput = document.getElementById('unit');
    
    const unitMap = {
        'length': 'mm', 'width': 'mm', 'thickness': 'mm', 'warping': 'mm',
        'water_absorption': '%', 'breaking_strength': 'N', 'abrasion_resistance': 'PEI'
    };
    
    if (category && unitMap[category]) {
        unitInput.value = unitMap[category];
    }
});
</script>
{% endblock %}